<ion-view id="messageGroupDetail" view-title={{chatname}}>
  <ion-nav-bar align-title="center">

    <ion-nav-buttons side="left">
      <button class="button  button-icon icon ion-ios-arrow-back" ng-click="backSecondMenu(grouptype)">
        即时通
      </button>
    </ion-nav-buttons>

    <ion-nav-buttons side="right">
      <button class="button button-icon icon ion-ios-people-outline"
              ng-click="goGroupDetail(groupid,chatname,grouptype,ismygroup)"
              style="margin-right: 5px"></button>
    </ion-nav-buttons>

  </ion-nav-bar>

  <ion-content class="rj-stable-content" delegate-handle="messageDetailsScroll" on-drag="onDrag()"
               ng-click="zhilinggroup()" id="contentbb">
    <ion-refresher refreshing-icon="ion-loading-c" on-refresh="doRefresh()" refreshing-text="获取数据中..."
                   pulling-text="更多消息" id="refresh">
    </ion-refresher>
    <p style="text-align: center" ng-if="nomore === 'true'" ng-click="skipgroupmessagebox()">更多消息请在历史消息中查阅</p>
    <div style="margin-bottom: 10px;">
      <!--<p class="rj-message-time">5月27日 16:33</p>-->

      <div ng-repeat="msg in groupmsgs">
        <div ng-if="(msg.from === 'true') &&(msg.senderid === myUserID)">
          <p style="height:20px;width:50px;background-color:#c2ccd1;margin: 3px auto;" ng-if="msg.istime === 'true' && msg.daytype ==='1' " align="center" >{{msg.when | date:'HH:mm'}}</p>
          <p style="height:20px;width:150px;background-color: #c2ccd1;margin:3px auto;" ng-if="msg.istime === 'true' && msg.daytype ==='0'" align="center" >{{msg.when | date:'yyyy-MM-dd HH:mm'}}</p>
        </div>
        <!--<div >-->
          <!--<p ng-if="msg.istime === 'true' && msg.daytype ==='1' " style="margin-top: 5px;margin:0 auto;">{{msg.when | date:'HH:mm'}}</p>-->
          <!--<p ng-if="msg.istime === 'true' && msg.daytype ==='0' " style="margin-top: 5px;margin:0 auto;" >{{msg.when | date:'yyyy-MM-dd HH:mm'}}</p>-->
        <!--</div>-->

        <div class="rj-message-wrap" ng-if="(msg.from==='false') && (msg.sessionid === groupid) &&(!(msg.messagetype.substr(0,5)==='Event'))">
          <div >
            <p style="height:20px;width:50px;background-color:#c2ccd1;margin: 3px auto;" ng-if="msg.istime === 'true' && msg.daytype ==='1' " align="center" >{{msg.when | date:'HH:mm'}}</p>
            <p style="height:20px;width:150px;background-color: #c2ccd1;margin:3px auto;" ng-if="msg.istime === 'true' && msg.daytype ==='0'" align="center" >{{msg.when | date:'yyyy-MM-dd HH:mm'}}</p>
          </div>
          <div ng-if="msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==1||msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==9" class=" circle1" style=" position: absolute;left: 3%;font-size: 14px;padding-top: 9px" ng-click="godetail(msg.senderid)">{{msg.username.length > 2 ? msg.username.substring((msg.username.length-2),msg.username.length):msg.username}}</div>
          <div ng-if="msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==2||msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==8" class=" circle2" style=" position: absolute;left: 3%;font-size: 14px;padding-top: 9px" ng-click="godetail(msg.senderid)">{{msg.username.length > 2 ? msg.username.substring((msg.username.length-2),msg.username.length):msg.username}}</div>
          <div ng-if="msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==3||msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==7" class=" circle3" style=" position: absolute;left: 3%;font-size: 14px;padding-top: 9px" ng-click="godetail(msg.senderid)">{{msg.username.length > 2 ? msg.username.substring((msg.username.length-2),msg.username.length):msg.username}}</div>
          <div ng-if="msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==4||msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==6" class=" circle4" style=" position: absolute;left: 3%;font-size: 14px;padding-top: 9px" ng-click="godetail(msg.senderid)">{{msg.username.length > 2 ? msg.username.substring((msg.username.length-2),msg.username.length):msg.username}}</div>
          <div ng-if="msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==5||msg.senderid.substring((msg.senderid.length-1),msg.senderid.length)==0" class=" circle5" style=" position: absolute;left: 3%;font-size: 14px;padding-top: 9px" ng-click="godetail(msg.senderid)">{{msg.username.length > 2 ? msg.username.substring((msg.username.length-2),msg.username.length):msg.username}}</div>
          <!--<p class="rj-message" style="margin-left: 14.5%">{{msg.message}}</p>-->
            <span>
            <!---接收图片ui--->
            <p class="rj-message" style="margin-left: 12.5%;background-color: rgba(255, 255, 255, 0)" ng-if="msg.messagetype === 'Image'">
                <img src="{{msg.message.split('###')[1]}}" style="width: 110px;" class="yuanjiao"
                  ng-click="netScaleImage(msg.message.split('###')[0],msg.message.split('###')[4],msg.message.split('###')[1])"/>
            </p>
            <!---接收地理位置ui--->
            <!--<p class="rj-message" style="" ng-if="msg.messagetype === 'LOCATION'"><img-->
              <!--src="img/beifengwolu.jpg" style="width: 110px;" class="yuanjiao" ng-click="entermap(msg.message)"/>-->
            <!--</p>-->
            <p ng-if="msg.messagetype === 'LOCATION'">
              <div class="list" ng-if="msg.messagetype === 'LOCATION'"
                 style="width: 210px;background-color: #888888;float: left;margin-left: 14.5%;">
                <a class="item item-icon-left"
                 ng-click="entergroupmap(msg.message)">
                  <img class="icon" ng-src="{{getFileTypeImg('location')}}"
                     style="width: 35px;padding-top: 10px;padding-bottom: 10px;"/>
                  <font style="font-size: 10px;border: none;">{{msg.message.split(',')[2]}}<br/>已接收</font>
                </a>
              </div>
              <div ng-if="msg.messagetype === 'LOCATION'" style="float: none;">
              </div>
            </p>
            <!---接收文字ui--->
            <p  class="rj-message" style="margin-left: 14.5%"
               ng-if="msg.messagetype === 'normal' || msg.messagetype === 'Text'">{{msg.message}}
            </p>
            <!---接收文件ui--->
            <p class="rj-message"  ng-if="msg.messagetype === 'File'">
              <img ng-src="{{msg.message.split('###')[1]}}"
                 ng-if="msg.messagetype === 'File' && getFileType(msg.message)"
                 style="width: 110px;" class="yuanjiao"/>
              <div class="list" ng-if="msg.messagetype === 'File' && !getFileType(msg.message)"
                 style="width: 210px;background-color: #888888;float: left;margin-left: 5%;">
              <a class="item item-icon-left"
                 ng-click="openGroupAllFile(msg.message.split('###')[1], msg)">
                <img class="icon" ng-src="{{getFileTypeImg(msg.message)}}"
                     style="width: 35px;padding-top: 10px;padding-bottom: 10px;"/><font
                style="font-size: 10px;border: none;">{{getFileName(msg.message)}}<br/><div ng-show="msg.message.split('###')[5] != '0' && msg.message.split('###')[5] != '100' && msg.message.split('###')[5] != '-1'" class="outbar" style="margin-top: 10px;"><div class="inbar" style="width:{{msg.message.split('###')[5]}}%;background:#5CB85C;"></div></div><span ng-show="msg.message.split('###')[5] != '0' && msg.message.split('###')[5] != '100' && msg.message.split('###')[5] != '-1'">&nbsp;&nbsp;{{msg.message.split('###')[5]}}%</span><span ng-show="msg.message.split('###')[5] === '100'" style="color: #5CB85C;">已下载</span><span ng-show="msg.message.split('###')[5] === '0'">未下载</span><span ng-show="msg.message.split('###')[5] === '-1'" style="color: #ee0500;">下载失败！</span></font>
              </a>
              </div>
              <div ng-if="msg.messagetype === 'File' && !getFileType(msg.message)" style="float: none;">
              </div>
            </p>
          </span>
        </div>


        <!--发送消息-->
        <div class="rj-message-wrap" ng-if="(msg.from === 'true') &&(msg.senderid === myUserID)">

          <!--<span class="rj-triangle-right"-->
                <!--ng-if="msg.messagetype === 'Text' || msg.messagetype === 'normal'"></span>-->
          <!---展示用户头像--->
          <div class="circle6"
               style=" position: absolute;left: 86%;top: 10px;font-size: 14px;text-align: center;padding-top: 9px;">
            {{msg.username.length > 2 ? msg.username.substring((msg.username.length-2),msg.username.length):msg.username}}
          </div>

          <!---根据消息类型区分--->
           <span>
             <p style="margin-right: 12.5%;float: right;">

               <!--发送图片ui-->
               <font class="rj-message-wrap" ng-if="msg.messagetype === 'Image'">
                <img style="background-color: transparent;margin-left: -30px" src="img/red.png"
                   ng-if="msg.isFailure ==='true'"
                   ng-click="resendgroupshow(groupid,msg.message, groupid,grouptype, localusr,myUserID,msg._id,msg)"/>
                <ion-spinner icon="ios-small"
                           style="background-color: transparent;margin-left: -35px;position: relative;vertical-align: middle"
                           ng-if="msg.isSuccess === 'false'&& msg.isFailure === 'false' "></ion-spinner>
                <img src="{{msg.message.split('###')[1]}}" style="width: 110px;margin-right: 10px;" class="yuanjiao"
                   ng-click="boostImage(msg.message.split('###')[1])"/>
                </font>


               <!---发送文件的ui--->
               <font  ng-if="msg.messagetype === 'File'">
                  <img ng-src="{{msg.message.split('###')[1]}}"
                    ng-if="msg.messagetype === 'File' && getFileType(msg.message)" style="width: 110px;"
                    class="yuanjiao" ng-click="boostImage(msg.message.split('###')[1])"/>
                  <div class="list" ng-if="msg.messagetype === 'File' && !getFileType(msg.message)"
                    style="width: 210px;background-color: #888888;float: right;margin-right: 10px;">
                    <a class="item item-icon-left" ng-if="msg.isFailure != 'true'"
                      ng-click="openGroupAllFile(msg.message.split('###')[1],msg)">
                      <img class="icon" ng-src="{{getFileTypeImg(msg.message)}}"
                        style="width: 35px;padding-top: 10px;padding-bottom: 10px;"/>
                      <font style="font-size: 10px;border: none;">{{msg.message.split('###')[4]}}
                        <br/><div ng-show="msg.message.split('###')[5] != '100'" class="outbar" style="margin-top: 10px;"><div class="inbar" style="width:{{msg.message.split('###')[5]}}%;background:#5CB85C;"></div></div><span ng-show="msg.message.split('###')[5] != '100'">&nbsp;&nbsp;{{msg.message.split('###')[5]}}%</span>
                  &nbsp;&nbsp;<span ng-if="msg.isFailure === 'true' && msg.message.split('###')[5] === '-1'" style="color: #ee0500;">发送失败！</span><span ng-if="msg.isFailure === 'false' && msg.message.split('###')[5] === '100'" style="color: #5CB85C;">发送成功！</span>
                      </font>
                    </a>
                    <a class="item item-icon-left" ng-if="msg.isFailure === 'true'"
                      ng-click="resendgroupshow(groupid,msg.message, groupid,grouptype, localusr,myUserID,msg._id,msg)">
                      <img class="icon" ng-src="{{getFileTypeImg(msg.message)}}"
                        style="width: 35px;padding-top: 10px;padding-bottom: 10px;"/>
                      <font style="font-size: 10px;border: none;">{{msg.message.split('###')[4]}}
                        <br/>{{msg.message.split('###')[3]}}
                        &nbsp;&nbsp;<span ng-if="msg.isFailure === 'true'" style="color: #ee0500;">发送失败！</span>
                      </font>
                    </a>
                  </div>
                  <div ng-if="msg.messagetype === 'File' && !getFileType(msg.message)" style="float: none;">
                  </div>
              </font>

               <!----发送位置的ui-->
              <font  ng-if="msg.messagetype === 'LOCATION'">
                <div class="list" ng-if="msg.messagetype === 'LOCATION'"
                  style="width: 210px;background-color: #888888;float: right;margin-right: 10px;">
                <a class="item item-icon-left" ng-if="msg.isFailure != 'true'"
                  ng-click="entergroupmap(msg.message.substring(0, msg.message.lastIndexOf(',')))" >
                  <img class="icon" ng-src="{{getFileTypeImg('location')}}"
                     style="width: 35px;padding-top: 10px;padding-bottom: 10px;"/>
                  <font style="font-size: 10px;border: none;margin-left: 10px;">{{msg.message.split(',')[2]}}
                    <br/>点击查看
                    <!--&nbsp;&nbsp;<span ng-if="msg.isFailure === 'false'" style="color: #ee0500;">发送成功！</span>-->
                  </font>
                </a>
                <a class="item item-icon-left" ng-if="msg.isFailure === 'true'"
                  ng-click="resendgroupshow(groupid,msg.message, groupid, localusr,myUserID,msg._id,msg)">
                  <img class="icon" ng-src="{{getFileTypeImg('location')}}"
                     style="width: 35px;padding-top: 10px;padding-bottom: 10px;"/>
                  <font style="font-size: 10px;border: none;margin-left: 5px;">{{msg.message.split(',')[2]}}
                    <br/>点击查看
                    &nbsp;&nbsp;<span ng-if="msg.isFailure === 'true'" style="color: #ee0500;">发送失败！</span>
                  </font>
                </a>
                </div>
                <div ng-if="msg.messagetype === 'LOCATION'" style="float: none;">
                </div>
              </font>

               <!---发送文字ui--->
               <font class="rj-message-right" ng-if="msg.messagetype === 'normal' || msg.messagetype === 'Text'"
                     style="color: #ffffff">
                 <img  style="margin-left:-24px;background-color: transparent" src="img/red.png"
                      ng-if="(msg.isFailure === 'true') && (msg.isSuccess === 'false')"
                      ng-click="resendgroupshow(groupid,msg.message,groupid,grouptype,localusr,myUserID,msg._id,msg)"/>
                 <ion-spinner icon="ios-small"  style="background-color: transparent;margin-left: -35px;position: relative;vertical-align: middle"
                              ng-if="msg.isSuccess === 'false'&& msg.isFailure === 'false' ">
                 </ion-spinner>
                 {{msg.message}}
               </font>

              </p>
          </span>
        </div>
        <!--<div>-->
        <!--<p ng-if="msg.messagetype.substr(0,5)==='Event'" style="margin-top: 5px;" align="center">{{msg.message}}</p>-->
        <!--</div>-->
        <div>
          <p ng-if="msg.messagetype.substr(0,5)==='Event' && (msg.sessionid === groupid) " style="margin-top: 5px;"
             align="center">{{msg.message}}</p>
        </div>
      </div>
</div>
    <!--</div>-->

  </ion-content>

  <ion-footer-bar class="bar-light" style="height: auto">
    <div class="rj-footer-btn-wrap" style="margin-top: 37px">
      <!--<button class="button button-icon icon ion-ios-mic-outline rj-footer-btn-left">-->
      <!--</button>-->
    </div>

    <div class="item-input rj-footer-btn-wrap" style="width: 72%" ng-click="zhilinggroup()">
      <textarea msd-elastic ng-model="send_content" style="margin-right: 45px">
      </textarea>
    </div>

    <div class="rj-footer-btn-wrap"><!--style="margin-left: 15px;margin-right: 5px"-->
      <div class="buttons rj-footer-btn-wrap" style="margin-top: 22px;width: 15px;height: 15px">
        <!--<button class="rj-footer-btn button button-icon icon ion-happy-outline"></button>-->
      </div>
      <div class="buttons" ng-show="!send_content || send_content === ''" ng-click="gengduogropu()">
        <button class="button button-icon icon ion-ios-plus-outline rj-footer-btn-left">
        </button>
      </div>
      <div class="rj-send-button" ng-hide="!send_content || send_content === ''"
           ng-click="sendSingleGroupMsg(groupid,send_content,groupid,grouptype,localusr,myUserID,_id,'Text')">
        <p>发送</p>
      </div>
    </div>
    <div ng-if="bgroup==1" style="height:200px;margin-left: -94%;margin-top: 5px">

      <div class="row" align="center">
        <!--<div id="butAlbum" ng-click="getPhoto('PHOTOLIBRARY',userId,send_content, userId,localusr,myUserID,_id)" class="col" align="center" style="padding: 16px">-->
        <div class="col" ng-click="takeGroupPhoto(groupid,send_content, groupid,localusr,myUserID,_id, grouptype)"
             align="center"
             style="padding: 15px">
          <!--<div class="col" ng-click="getPhoto('CAMERA',userId,send_content, userId,localusr,myUserID,_id)" align="center" style="padding: 15px">-->
          <a>
            <ul>
              <li style="height: 50px;width: 50px;align-content: center" class="squareliao1"><img src="img/paizhao.png"
                                                                                                  style="width: 28px;height: 28px;align-content: center;margin-top: 9px">
              </li>
              <li style="color: #848484;font-size: 10px">拍照</li>
            </ul>
          </a>
        </div>
        <div id="butAlbum"
             ng-click="openGroupDocumentWindow('image', groupid,send_content, groupid,localusr,myUserID,_id, grouptype)"
             class="col" align="center" style="padding: 15px">
          <!--<div id="butAlbum" ng-click="getPhoto('PHOTOLIBRARY',userId,send_content, userId,localusr,myUserID,_id)" class="col" align="center" style="padding: 15px">-->
          <a>
            <ul>
              <li style="height: 50px;width: 50px;align-content: center" class="squareliao1"><img src="img/tupian.png"
                                                                                                  style="width: 28px;height: 28px;align-content: center;margin-top: 9px">
              </li>
              <li style="color: #848484;font-size: 10px">相册</li>
            </ul>
          </a>
        </div>
        <div class="col" align="center"
             ng-click="openGroupDocumentWindow('*', groupid,send_content, groupid,localusr,myUserID,_id, grouptype)"
             style="padding: 15px">
          <a>
            <ul>
              <li style="height: 50px;width: 50px;align-content: center" class="squareliao1"><img src="img/wenjian.png"
                                                                                                  style="width: 28px;height: 28px;align-content: center;margin-top: 9px">
              </li>
              <li style="color: #848484;font-size: 10px">文件</li>
            </ul>
          </a>
        </div>
        <div class="col" align="center" style="padding: 15px"
             ng-click="gogegrouplocation('LOCATION',groupid,send_content, groupid,localusr,myUserID,_id,grouptype,ismygroup)"
        >
          <a>
            <ul>
              <li style="height: 50px;width: 50px;align-content: center" class="squareliao1"><img src="img/dingwei.png"
                                                                                                  style="width: 28px;height: 28px;align-content: center;margin-top: 9px">
              </li>
              <li style="color: #848484;font-size: 10px">定位</li>
            </ul>
          </a>
        </div>

      </div>
      <!--<div class="row" style="margin-top: -22%">-->
      <!--<div class="col" align="center" ng-click="openDocumentWindow('video', userId,send_content, userId,localusr,myUserID,_id)" style="padding: 15px">-->
      <!--<a>-->
      <!--<ul>-->
      <!--<li style="height: 50px;width: 50px;align-content: center" class="squareliao1"><img src="img/shipin.png" style="width: 28px;height: 28px;align-content: center;margin-top: 9px"></li>-->
      <!--<li style="color: #848484;font-size: 10px">视频</li>-->
      <!--</ul>-->
      <!--</a>-->
      <!--</div>-->
      <!--<div class="col" align="center" ng-click="openDocumentWindow('audio', userId,send_content, userId,localusr,myUserID,_id)" style="padding: 15px">-->
      <!--<a>-->
      <!--<ul>-->
      <!--<li style="height: 50px;width: 50px;align-content: center" class="squareliao1"><img src="img/yinpin.png" style="width: 28px;height: 28px;align-content: center;margin-top: 9px"></li>-->
      <!--<li style="color: #848484;font-size: 10px">音频</li>-->
      <!--</ul>-->
      <!--</a>-->
      <!--</div>-->
      <!--<div class="col" align="center" style="padding: 15px">-->
      <!--<a>-->
      <!--<ul>-->
      <!--<li style="height: 50px;width: 50px;align-content: center"> </li>-->
      <!--<li style="color: #848484;font-size: 10px"> </li>-->
      <!--</ul>-->
      <!--</a>-->
      <!--</div>-->
      <!--<div class="col" align="center" style="padding: 15px">-->
      <!--<a>-->
      <!--<ul>-->
      <!--<li style="height: 50px;width: 50px;align-content: center"> </li>-->
      <!--<li style="color: #848484;font-size: 10px"> </li>-->
      <!--</ul>-->
      <!--</a>-->
      <!--</div>-->
    </div>
  </ion-footer-bar>
</ion-view>
